<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Development | Fluent Bit</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.1.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    

        
    
    
    
    <link rel="prev" href="../output/stdout.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="5" data-basepath=".." data-revision="Mon Aug 31 2015 21:32:52 GMT-0600 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="about/index.html">
            
                
                    <a href="../about/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        About
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="about/fluentd_and_fluentbit.html">
            
                
                    <a href="../about/fluentd_and_fluentbit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Fluentd &amp; Fluent Bit
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="about/license.html">
            
                
                    <a href="../about/license.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        License
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="getting_started/index.html">
            
                
                    <a href="../getting_started/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Getting Started
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="getting_started/requirements.html">
            
                
                    <a href="../getting_started/requirements.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Requirements
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="getting_started/installation.html">
            
                
                    <a href="../getting_started/installation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Build and Install
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="getting_started/debian_ubuntu.html">
            
                
                    <a href="../getting_started/debian_ubuntu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Debian/Ubuntu
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="getting_started/raspberry_pi.html">
            
                
                    <a href="../getting_started/raspberry_pi.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.</b>
                        
                        Raspberry Pi
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="input/index.html">
            
                
                    <a href="../input/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Input Plugins
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="input/cpu.html">
            
                
                    <a href="../input/cpu.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        CPU Usage
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="input/kmsg.html">
            
                
                    <a href="../input/kmsg.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Kernel Log Buffer
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="input/mem.html">
            
                
                    <a href="../input/mem.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Memory Usage
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="input/mqtt.html">
            
                
                    <a href="../input/mqtt.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        MQTT
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="input/serial.html">
            
                
                    <a href="../input/serial.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        Serial Interface
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="input/stdin.html">
            
                
                    <a href="../input/stdin.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        Standard Input
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="input/xbee.html">
            
                
                    <a href="../input/xbee.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        XBee Radio
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="output/index.html">
            
                
                    <a href="../output/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Output Plugins
                    </a>
                
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="output/fluentd.html">
            
                
                    <a href="../output/fluentd.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        Fluentd
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="output/stdout.html">
            
                
                    <a href="../output/stdout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        Standard Output
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="5" data-path="development/index.html">
            
                
                    <a href="../development/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Development
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Fluent Bit</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="fluent-bit-for-developers">Fluent Bit for Developers</h1>
<p><a href="http://fluentbit.io" target="_blank">Fluent Bit</a> have been designed and built to be used not just as a standalone tool, it can also be embedded in your C or C++ applications.</p>
<p>The following section presents details about how you can use <a href="http://fluentbit.io" target="_blank">Fluent Bit</a> inside your own application.</p>
<h2 id="internals">Internals</h2>
<p>When Fluent Bit is built, it creates the final binary but also it creates a shared library version called <em>libfluent-bit.so</em> which can be linked in your projects. The library allows you to enqueue data into the engine and return as quickly as possible, all hard job is done in <em>one</em> posix thread who works in asynchronous mode, your caller process or thread will not be blocked.</p>
<p>The workflow to use the library is pretty straigh forward and involve the following calls in the given order:</p>
<table>
<thead>
<tr>
<th>step</th>
<th>function &amp; prototype</th>
<th>optional</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>flb_config_init()</td>
<td>No</td>
</tr>
<tr>
<td>2</td>
<td>flb_config_verbose(int enabled)</td>
<td>Yes</td>
</tr>
<tr>
<td>3</td>
<td>flb_lib_config_file(struct flb_config <em>config, char </em>path)</td>
<td>Yes</td>
</tr>
<tr>
<td>4</td>
<td>flb_lib_init(struct flb_config <em>config, char </em>output)</td>
<td>No</td>
</tr>
<tr>
<td>5</td>
<td>flb_lib_start(struct flb_config *config)</td>
<td>No</td>
</tr>
<tr>
<td>6</td>
<td>flb_lib_push(struct flb_config <em>config, void </em>data, size_t len)</td>
<td>Yes</td>
</tr>
<tr>
<td>7</td>
<td>flb_lib_stop(struct flb_config *config)</td>
<td>No</td>
</tr>
</tbody>
</table>
<p>Below a description of each specific function involved:</p>
<h4 id="1-flb-config-init">1. flb_config_init</h4>
<p>The purpose of this function is to create a library configuration context that you will use on all the further calls. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-keyword">struct</span> flb_config *flb_config_init();
</code></pre>
<p>the function do not take any argument. Upon successful completion it returns a configuration context of <em>struct flb_config</em> data type, on error it returns NULL.</p>
<h4 id="2-flb-config-verbose">2. flb_config_verbose</h4>
<p>The library support a verbose mode to track specific events when enqueuing and processing data, by default default messages are disabled and this function can be used to turn it on or off. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_config_verbose</span><span class="hljs-params">(<span class="hljs-keyword">int</span> enabled)</span></span>;
</code></pre>
<p>The <em>enabled</em> argument can be <em>FLB_TRUE</em> or <em>FLB_FALSE</em> depending of the desired behavior. Upon successful completion it returns zero, otherwise it returns a negative value.</p>
<h4 id="3-flb-lib-config-file">3. flb_lib_config_file</h4>
<p>Some output interfaces requires a configuration file, this interface allows to load a configuration file, some configuration files can be found on the <a href="https://github.com/fluent/fluent-bit/tree/master/conf" target="_blank">conf/</a> directory. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_lib_config_file</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flb_config *config, <span class="hljs-keyword">char</span> *path)</span></span>;
</code></pre>
<p>The first argument is the configuration context created on step <em>#1</em>. The second argument <em>path</em> is an <strong>absolute path</strong> to the location of the configuration file. Upon successful completion it returns zero, otherwise it returns a negative value.</p>
<h4 id="4-flb-lib-init">4. flb_lib_init</h4>
<p>This function start the library configuration allowing to setup the desired output interface. Remember that Fluent Bit support many output interfaces and depending of how it was built you will have all or some of them available (for more details refer to the <a href="../getting_started/installation">installation</a> section. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_lib_init</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flb_config *config, <span class="hljs-keyword">char</span> *output)</span></span>;
</code></pre>
<p>The first argument <em>config</em> represents the configuration context retrieved on step <em>#1</em>. The <em>output</em> argument refers to the output plugin that you may want to use. Upon successful completion it returns zero, otherwise it returns a negative value.</p>
<h4 id="5-flb-lib-start">5. flb_lib_start</h4>
<p>This function takes care to initialize the background service or main thread that will be listening for data. It spawn a posix thread and make able an interface to push data into the engine. This function is safe to use and will only return once the <a href="http://fluentbit.io" target="_blank">Fluent Bit</a> engine is ready to process messages. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_lib_start</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flb_config *config)</span></span>;
</code></pre>
<p>The only argument this function requires is the main configuration context created on step <em>#1</em>. Upon successful completion it returns zero, otherwise it returns a negative value.</p>
<h4 id="6-flb-lib-push">6. flb_lib_push</h4>
<p>This function is the one you should use in your main program to push data into the <a href="http://fluentbit.io" target="_blank">Fluent Bit</a> engine. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_lib_push</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flb_config *config, <span class="hljs-keyword">void</span> *data, size_t len)</span></span>;
</code></pre>
<p>The first argument represents the configuration context created on step <em>#1</em>. The <em>data</em> argument is a buffer which references the data that you want to be processed, it expect that you pass a <strong>valid JSON</strong> message, it&apos;s recomendable that per call you don&apos;t pass a string larger than 64KB to avoid performance penalties. The third argument <em>len</em> indicate the amount of bytes to read from the <em>data</em> pointer reference, make sure that <em>len</em> is always a valid value.</p>
<p>Upon successful completion it returns the number of bytes processed, otherwise it returns a negative value.</p>
<h4 id="7-flb-lib-stop">7. flb_lib_stop</h4>
<p>This function instruct the Engine to stop processing events and perform a cleanup of the internal data. Before to return it will force a data flush to the output plugin in question to avoid data loss, then the worker thread will be stopped. It prototype is the following:</p>
<pre><code class="lang-C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">flb_lib_stop</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> flb_config *config)</span></span>;
</code></pre>
<p>It only takes one argument which is the configuration context created on step <em>#1</em>.  Upon successful completion it returns zero, otherwise it returns a negative value.</p>
<h2 id="example">Example</h2>
<p>Here is an example where we create a instance to enqueue some random JSON messages and we instruct it to write them (after processing) to the standard output:</p>
<pre><code class="lang-C"><span class="hljs-preprocessor">#<span class="hljs-keyword">include</span> &lt;fluent-bit.h&gt;</span>

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-keyword">int</span> i;
    <span class="hljs-keyword">int</span> n;
    <span class="hljs-keyword">int</span> ret;
    <span class="hljs-keyword">char</span> tmp[<span class="hljs-number">256</span>];
    <span class="hljs-keyword">struct</span> flb_config *config;

    <span class="hljs-comment">/* Create configuration context */</span>
    config = flb_config_init();
    <span class="hljs-keyword">if</span> (!config) {
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }

    <span class="hljs-comment">/* Initialize library */</span>
    ret = flb_lib_init(config, <span class="hljs-string">&quot;stdout&quot;</span>);
    <span class="hljs-keyword">if</span> (ret != <span class="hljs-number">0</span>) {
        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);
    }

    <span class="hljs-comment">/* Start the background worker */</span>
    flb_lib_start(config);

    <span class="hljs-comment">/* Push some data */</span>
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
        n = <span class="hljs-built_in">snprintf</span>(tmp, <span class="hljs-keyword">sizeof</span>(tmp) - <span class="hljs-number">1</span>, <span class="hljs-string">&quot;{\&quot;key\&quot;: \&quot;val %i\&quot;}&quot;</span>, i);
        flb_lib_push(config, tmp, n);
    }

    <span class="hljs-comment">/* Stop and cleanup */</span>
    flb_lib_stop(config);

    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>As you can see we only need to include the <strong>fluent-bit.h</strong> header and use the functions documented in the right order. For more details about how to make this code work please look at the examples directory where we have <a href="https://github.com/fluent/fluent-bit/tree/master/examples" target="_blank">examples</a> in C and C++ languages. We also include an example on how to push data to <a href="http://www.treasuredata.com" target="_blank">Treasure Data</a> service.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../output/stdout.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Standard Output"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
